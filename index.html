<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Formatura360</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#0f172a;--secondary:#64748b;--accent:#6366f1;
  --border:#e5e7eb;--danger:#ef4444;--percent:0deg
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Inter,sans-serif;
  background:linear-gradient(180deg,#f8fafc,#eef2ff);
  color:var(--primary)
}
header{
  background:rgba(255,255,255,.9);
  backdrop-filter:blur(10px);
  padding:20px 40px;
  border-bottom:1px solid var(--border);
  display:flex;justify-content:space-between;align-items:center;
  position:sticky;top:0;z-index:10
}
nav button{
  margin-left:8px;padding:10px 16px;border-radius:10px;
  border:none;background:transparent;cursor:pointer;
  color:var(--secondary);font-weight:500
}
nav button.active{background:var(--accent);color:#fff}
main{max-width:1200px;margin:auto;padding:40px}
.hidden{display:none}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px}
.card{
  background:#fff;padding:24px;border-radius:16px;
  border:1px solid var(--border);
  box-shadow:0 10px 24px rgba(0,0,0,.05)
}
.dashboard-grid{
  display:grid;grid-template-columns:1fr 1fr;
  gap:24px;margin-top:24px
}
.countdown-box{display:flex;justify-content:space-between;align-items:center}
.countdown-icon{font-size:64px;opacity:.15}
.budget-circle{
  width:150px;height:150px;border-radius:50%;
  background:conic-gradient(
    var(--accent) 0deg,
    var(--accent) var(--percent),
    #e5e7eb var(--percent)
  );
  display:flex;align-items:center;justify-content:center;
  margin:16px auto
}
.budget-circle span{
  background:#fff;width:90px;height:90px;
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-weight:700
}
input{
  width:100%;padding:12px;border-radius:10px;
  border:1px solid var(--border);margin-top:8px
}
button.primary{
  margin-top:12px;background:var(--accent);
  color:#fff;border:none;border-radius:10px;
  padding:12px;font-weight:600;cursor:pointer
}
table{
  width:100%;margin-top:24px;border-collapse:collapse;
  background:#fff;border-radius:16px;overflow:hidden
}
th,td{padding:14px;border-bottom:1px solid var(--border)}
th{background:#f1f5f9;color:var(--secondary)}
td button{
  background:none;border:none;color:var(--danger);
  cursor:pointer;font-size:16px
}
</style>
</head>

<body>

<header>
  <h2>üéì Formatura360</h2>
  <nav>
    <button id="btn-dashboard" class="active" onclick="show('dashboard')">Dashboard</button>
    <button id="btn-items" onclick="show('items')">Itens</button>
    <button id="btn-finance" onclick="show('finance')">Financeiro</button>
    <button onclick="logout()">Sair</button>
  </nav>
</header>

<main id="app" class="hidden">

<section id="dashboard">
  <div class="cards">
    <div class="card"><h4>Total de Itens</h4><strong id="totalItems">0</strong></div>
    <div class="card"><h4>Pend√™ncias</h4><strong id="pendingItems">0</strong></div>
    <div class="card"><h4>Total Gasto</h4><strong id="totalSpent">R$ 0,00</strong></div>
    <div class="card"><h4>Dispon√≠vel</h4><strong id="available">R$ 0,00</strong></div>
  </div>

  <div class="dashboard-grid">
    <div>
      <div class="card">
        <div class="countdown-box">
          <div>
            <h3>Contagem Regressiva</h3>
            <input type="date" id="date">
            <p id="countdown"></p>
          </div>
          <div class="countdown-icon">üéì</div>
        </div>
      </div>

      <div class="card" style="margin-top:16px">
        <h3>Or√ßamento Total</h3>
        <input type="number" id="budgetInput" placeholder="Ex: 15000">
        <button class="primary" onclick="setBudget()">Salvar</button>
      </div>
    </div>

    <div class="card">
      <h3>Vis√£o Geral do Or√ßamento</h3>
      <div class="budget-circle">
        <span id="budgetPercent">0%</span>
      </div>
      <p><strong>Total:</strong> <span id="budgetTotalView"></span></p>
      <p><strong>Comprometido:</strong> <span id="budgetUsedView"></span></p>
      <p><strong>Livre:</strong> <span id="budgetFreeView"></span></p>
    </div>
  </div>
</section>

<section id="items" class="hidden">
  <div class="card">
    <h3>Adicionar Item</h3>
    <input id="itemName" placeholder="Item">
    <input id="itemSupplier" placeholder="Fornecedor">
    <input id="itemValue" type="number" placeholder="Valor">
    <button class="primary" onclick="addItem()">Adicionar</button>
  </div>

  <table>
    <thead>
      <tr><th>Item</th><th>Fornecedor</th><th>Valor</th><th>Pago</th><th></th></tr>
    </thead>
    <tbody id="itemsTable"></tbody>
  </table>
</section>

<section id="finance" class="hidden">
  <div class="card">
    <h3>Adicionar Despesa</h3>
    <input id="financeName" placeholder="Descri√ß√£o">
    <input id="financeValue" type="number" placeholder="Valor">
    <button class="primary" onclick="addFinance()">Adicionar</button>
  </div>

  <table>
    <thead>
      <tr><th>Descri√ß√£o</th><th>Valor</th><th></th></tr>
    </thead>
    <tbody id="financeTable"></tbody>
  </table>
</section>

</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

/* üî¥ COLE AQUI SEU firebaseConfig */
const firebaseConfig = {
  apiKey: "AIzaSyA2Ae7UIvQtga0bICPVunVwc_Tjaxiss6A",
  authDomain: "formatura-360.firebaseapp.com",
  projectId: "formatura-360",
  storageBucket: "formatura-360.firebasestorage.app",
  messagingSenderId: "527762396386",
  appId: "1:527762396386:web:e0ebaa9dbf62c125e9fabb"
};


const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const appEl = document.getElementById("app");
const money = v => v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

let state = { budget:0, date:"", items:[], finances:[] };
let userRef = null;

/* AUTH */
onAuthStateChanged(auth, async user=>{
  if(!user){ showLogin(); return; }
  userRef = doc(db,"users",user.uid);
  const snap = await getDoc(userRef);
  if(snap.exists()) state = snap.data();
  appEl.classList.remove("hidden");
  renderAll();
});

/* LOGIN */
function showLogin(){
  document.body.innerHTML=`
  <div style="height:100vh;display:flex;align-items:center;justify-content:center">
    <div class="card" style="width:320px">
      <h2>üîê Formatura360</h2>
      <input id="email" placeholder="E-mail">
      <input id="password" type="password" placeholder="Senha">
      <button class="primary" id="loginBtn">Entrar</button>
    </div>
  </div>`;
  document.getElementById("loginBtn").onclick=async()=>{
    try{
      await signInWithEmailAndPassword(auth,email.value,password.value);
      location.reload();
    }catch{
      alert("Usu√°rio ou senha inv√°lidos");
    }
  }
}
window.logout=()=>signOut(auth);

/* SAVE */
async function save(){
  await setDoc(userRef,state);
  renderAll();
}

/* RENDER */
function renderAll(){
  totalItems.textContent = state.items.length;
  pendingItems.textContent = state.items.filter(i=>!i.paid).length;

  const spentItems = state.items.filter(i=>i.paid).reduce((s,i)=>s+i.value,0);
  const spentFinance = state.finances.reduce((s,f)=>s+f.value,0);
  const spent = spentItems + spentFinance;

  totalSpent.textContent = money(spent);
  available.textContent = money(state.budget - spent);

  budgetTotalView.textContent = money(state.budget);
  budgetUsedView.textContent = money(spent);
  budgetFreeView.textContent = money(state.budget - spent);

  const pct = state.budget ? Math.min((spent/state.budget)*360,360) : 0;
  document.documentElement.style.setProperty("--percent",pct+"deg");
  budgetPercent.textContent = state.budget ? Math.round((spent/state.budget)*100)+"%" : "0%";

  renderItems();
  renderFinance();
  calc();
}

/* DASH */
window.setBudget = ()=>{
  state.budget = Number(budgetInput.value);
  save();
};

date.onchange = ()=>{
  state.date = date.value;
  save();
};

function calc(){
  if(!state.date) return;
  const d = Math.ceil((new Date(state.date)-new Date())/86400000);
  countdown.textContent = d>=0
    ? `Faltam ${d} dias para a formatura`
    : "Data passada";
}

/* ITEMS */
window.addItem = ()=>{
  state.items.push({
    name:itemName.value,
    supplier:itemSupplier.value,
    value:Number(itemValue.value),
    paid:false
  });
  itemName.value=itemSupplier.value=itemValue.value="";
  save();
};

window.toggleItem = i=>{
  state.items[i].paid = !state.items[i].paid;
  save();
};

window.removeItem = i=>{
  state.items.splice(i,1);
  save();
};

function renderItems(){
  itemsTable.innerHTML="";
  state.items.forEach((i,x)=>{
    itemsTable.innerHTML+=`
      <tr>
        <td>${i.name}</td>
        <td>${i.supplier}</td>
        <td>${money(i.value)}</td>
        <td><input type="checkbox" ${i.paid?"checked":""} onchange="toggleItem(${x})"></td>
        <td><button onclick="removeItem(${x})">üóë</button></td>
      </tr>`;
  });
}

/* FINANCE */
window.addFinance = ()=>{
  state.finances.push({
    name:financeName.value,
    value:Number(financeValue.value)
  });
  financeName.value=financeValue.value="";
  save();
};

window.removeFinance = i=>{
  state.finances.splice(i,1);
  save();
};

function renderFinance(){
  financeTable.innerHTML="";
  state.finances.forEach((f,i)=>{
    financeTable.innerHTML+=`
      <tr>
        <td>${f.name}</td>
        <td>${money(f.value)}</td>
        <td><button onclick="removeFinance(${i})">üóë</button></td>
      </tr>`;
  });
}

/* NAV */
window.show = page=>{
  dashboard.classList.add("hidden");
  items.classList.add("hidden");
  finance.classList.add("hidden");

  btnDashboard.classList.remove("active");
  btnItems.classList.remove("active");
  btnFinance.classList.remove("active");

  if(page==="dashboard"){dashboard.classList.remove("hidden");btnDashboard.classList.add("active")}
  if(page==="items"){items.classList.remove("hidden");btnItems.classList.add("active")}
  if(page==="finance"){finance.classList.remove("hidden");btnFinance.classList.add("active")}
};
</script>

</body>
</html>

